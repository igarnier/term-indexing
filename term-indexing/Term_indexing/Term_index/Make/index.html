<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Make (term-indexing.Term_indexing.Term_index.Make)</title><meta charset="utf-8"/><link rel="stylesheet" href="../../../../odoc.support/odoc.css"/><meta name="generator" content="odoc 2.4.2"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../../../odoc.support/highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body class="odoc"><nav class="odoc-nav"><a href="../index.html">Up</a> â€“ <a href="../../../index.html">term-indexing</a> &#x00BB; <a href="../../index.html">Term_indexing</a> &#x00BB; <a href="../index.html">Term_index</a> &#x00BB; Make</nav><header class="odoc-preamble"><h1>Module <code><span>Term_index.Make</span></code></h1></header><nav class="odoc-toc"><ul><li><a href="#parameters">Parameters</a></li><li><a href="#signature">Signature</a></li></ul></nav><div class="odoc-content"><h2 id="parameters"><a href="#parameters" class="anchor"></a>Parameters</h2><div class="odoc-spec"><div class="spec parameter anchored" id="argument-1-P"><a href="#argument-1-P" class="anchor"></a><code><span><span class="keyword">module</span> </span><span><a href="argument-1-P/index.html">P</a></span><span> : <a href="../../Intf/module-type-Signature/index.html">Intf.Signature</a></span></code></div></div><div class="odoc-spec"><div class="spec parameter anchored" id="argument-2-T"><a href="#argument-2-T" class="anchor"></a><code><span><span class="keyword">module</span> </span><span><a href="argument-2-T/index.html">T</a></span><span> : <a href="../../Intf/module-type-Term/index.html">Intf.Term</a> <span class="keyword">with</span> <span><span class="keyword">type</span> <a href="../../Intf/module-type-Term/index.html#type-prim">prim</a> = <a href="argument-1-P/index.html#type-t">P.t</a></span> <span class="keyword">and</span> <span><span class="keyword">type</span> <a href="../../Intf/module-type-Term/index.html#type-t">t</a> = <span><a href="argument-1-P/index.html#type-t">P.t</a> <a href="../../Term/index.html#type-term">Term.term</a></span></span></span></code></div></div><div class="odoc-spec"><div class="spec parameter anchored" id="argument-3-S"><a href="#argument-3-S" class="anchor"></a><code><span><span class="keyword">module</span> </span><span><a href="argument-3-S/index.html">S</a></span><span> : <a href="../../Intf/module-type-Subst/index.html">Intf.Subst</a> <span class="keyword">with</span> <span><span class="keyword">type</span> <a href="../../Intf/module-type-Subst/index.html#type-term">term</a> = <a href="argument-2-T/index.html#type-t">T.t</a></span></span></code></div></div><h2 id="signature"><a href="#signature" class="anchor"></a>Signature</h2><div class="odoc-include"><details open="open"><summary class="spec include"><code><span><span class="keyword">include</span> <a href="../../Intf/module-type-Term_index/index.html">Intf.Term_index</a>
  <span class="keyword">with</span> <span><span class="keyword">type</span> <a href="../../Intf/module-type-Term_index/index.html#type-term">term</a> = <a href="argument-2-T/index.html#type-t">T.t</a></span>
   <span class="keyword">and</span> <span><span class="keyword">type</span> <a href="../../Intf/module-type-Term_index/index.html#type-prim">prim</a> = <a href="argument-1-P/index.html#type-t">P.t</a></span>
   <span class="keyword">and</span> <span><span class="keyword">type</span> <a href="../../Intf/module-type-Term_index/index.html#type-subst">subst</a> = <a href="argument-3-S/index.html#type-t">S.t</a></span></span></code></summary><div class="odoc-spec"><div class="spec type anchored" id="type-prim"><a href="#type-prim" class="anchor"></a><code><span><span class="keyword">type</span> prim</span><span> = <a href="argument-1-P/index.html#type-t">P.t</a></span></code></div><div class="spec-doc"><p><code>prim</code> is the type of primitive symbols used in terms.</p></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-term"><a href="#type-term" class="anchor"></a><code><span><span class="keyword">type</span> term</span><span> = <a href="argument-2-T/index.html#type-t">T.t</a></span></code></div><div class="spec-doc"><p><code>term</code> is the type of first-order terms.</p></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-subst"><a href="#type-subst" class="anchor"></a><code><span><span class="keyword">type</span> subst</span><span> = <a href="argument-3-S/index.html#type-t">S.t</a></span></code></div><div class="spec-doc"><p><code>subst</code> is the type of substitutions, i.e. finite functions from variables to <a href="#type-term"><code>term</code></a>.</p></div></div><div class="odoc-spec"><div class="spec type subst anchored" id="type-var"><a href="#type-var" class="anchor"></a><code><span><span class="keyword">type</span> var</span><span> := int</span></code></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-internal_term"><a href="#type-internal_term" class="anchor"></a><code><span><span class="keyword">type</span> internal_term</span></code></div><div class="spec-doc"><p><code>internal_term</code> is the internal representation of terms in the index.</p><p>Due to the details of the implementation, it might be the case that the result of querying the index is a term containing cycle. This might occur if for instance the querying term contains variables overlapping the terms contained in the index.</p><p>The type <code>internal_term</code> is also used to represent substitutions.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-is_cyclic"><a href="#val-is_cyclic" class="anchor"></a><code><span><span class="keyword">val</span> is_cyclic : <span><a href="#type-internal_term">internal_term</a> <span class="arrow">&#45;&gt;</span></span> bool</span></code></div><div class="spec-doc"><p><code>is_cyclic term</code> checks whether a term contains a cycle or not.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-to_term"><a href="#val-to_term" class="anchor"></a><code><span><span class="keyword">val</span> to_term : <span><a href="#type-internal_term">internal_term</a> <span class="arrow">&#45;&gt;</span></span> <a href="#type-term">term</a></span></code></div><div class="spec-doc"><p><code>to_term term</code> creates a new term representing the internal term <code>term</code>.</p><p>Raises <code>Invalid_argument</code> if <code>term</code> contains a cycle.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-get_subst"><a href="#val-get_subst" class="anchor"></a><code><span><span class="keyword">val</span> get_subst : <span><a href="#type-internal_term">internal_term</a> <span class="arrow">&#45;&gt;</span></span> <a href="#type-subst">subst</a></span></code></div><div class="spec-doc"><p><code>get_subst term</code> extracts a substitution out of <code>term</code></p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-reduce"><a href="#val-reduce" class="anchor"></a><code><span><span class="keyword">val</span> reduce : 
  <span><span>(<span><a href="#type-prim">prim</a> <span class="arrow">&#45;&gt;</span></span> <span><span><span class="type-var">'a</span> array</span> <span class="arrow">&#45;&gt;</span></span> <span class="type-var">'a</span>)</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span>(<span><a href="#type-var">var</a> <span class="arrow">&#45;&gt;</span></span> <span><span><a href="#type-internal_term">internal_term</a> option</span> <span class="arrow">&#45;&gt;</span></span> <span class="type-var">'a</span>)</span> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="#type-internal_term">internal_term</a> <span class="arrow">&#45;&gt;</span></span>
  <span class="type-var">'a</span></span></code></div><div class="spec-doc"><p><code>reduce fprim fvar term</code> reduces <code>term</code> by recursively applying <code>fprim</code> on primitives applications and <code>fvar</code> on variables. If the variable is associated to a term in a substitution, the term is passed to <code>fvar</code> as <code>Some term</code>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-destruct"><a href="#val-destruct" class="anchor"></a><code><span><span class="keyword">val</span> destruct : 
  <span><span>(<span><a href="#type-prim">prim</a> <span class="arrow">&#45;&gt;</span></span> <span><span><a href="#type-internal_term">internal_term</a> array</span> <span class="arrow">&#45;&gt;</span></span> <span class="type-var">'a</span>)</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span>(<span><a href="#type-var">var</a> <span class="arrow">&#45;&gt;</span></span> <span><span><a href="#type-internal_term">internal_term</a> option</span> <span class="arrow">&#45;&gt;</span></span> <span class="type-var">'a</span>)</span> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="#type-internal_term">internal_term</a> <span class="arrow">&#45;&gt;</span></span>
  <span class="type-var">'a</span></span></code></div><div class="spec-doc"><p><code>destruct ifprim ifvar t</code> performs case analysis on the term <code>t</code></p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-pp_internal_term"><a href="#val-pp_internal_term" class="anchor"></a><code><span><span class="keyword">val</span> pp_internal_term : <span><a href="#type-internal_term">internal_term</a> <span class="xref-unresolved">Fmt</span>.t</span></span></code></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-t"><a href="#type-t" class="anchor"></a><code><span><span class="keyword">type</span> <span>'a t</span></span></code></div><div class="spec-doc"><p><code>'a t</code> is the type of term indexes mapping terms to values of type <code>'a</code>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-pp"><a href="#val-pp" class="anchor"></a><code><span><span class="keyword">val</span> pp : <span><span><span class="type-var">'a</span> <span class="xref-unresolved">Fmt</span>.t</span> <span class="arrow">&#45;&gt;</span></span> <span><span><span class="type-var">'a</span> <a href="#type-t">t</a></span> <span class="xref-unresolved">Fmt</span>.t</span></span></code></div><div class="spec-doc"><p><code>pp pp_val</code> allows to pretty-print values of type <code>'a t</code> given <code>pp_val</code>, a pretty-printer for values of type <code>'a</code>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-create"><a href="#val-create" class="anchor"></a><code><span><span class="keyword">val</span> create : <span>unit <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'a</span> <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p><code>create ()</code> creates an empty index.</p></div></div><p>The worst-case complexity of all operations below is proportional to the size of the index. Practical complexity depends heavily on the term distribution but should be much better.</p><div class="odoc-spec"><div class="spec value anchored" id="val-insert"><a href="#val-insert" class="anchor"></a><code><span><span class="keyword">val</span> insert : <span><a href="#type-term">term</a> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span> <span><span><span class="type-var">'a</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p><code>insert term v index</code> associates the value <code>v</code> to <code>term</code> in <code>index</code>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-update"><a href="#val-update" class="anchor"></a><code><span><span class="keyword">val</span> update : <span><a href="#type-term">term</a> <span class="arrow">&#45;&gt;</span></span> <span><span>(<span><span><span class="type-var">'a</span> option</span> <span class="arrow">&#45;&gt;</span></span> <span class="type-var">'a</span>)</span> <span class="arrow">&#45;&gt;</span></span> <span><span><span class="type-var">'a</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p><code>update term f index</code> associates the value <code>f None</code> to <code>term</code> if <code>term</code> is not already in <code>index</code>, or <code>f (Some v)</code> if <code>v</code> is already bound to <code>term</code>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-iter"><a href="#val-iter" class="anchor"></a><code><span><span class="keyword">val</span> iter : <span><span>(<span><a href="#type-term">term</a> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span> unit)</span> <span class="arrow">&#45;&gt;</span></span> <span><span><span class="type-var">'a</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p><code>iter f index</code> iterates <code>f</code> on all bindings of <code>index</code>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-iter_unifiable"><a href="#val-iter_unifiable" class="anchor"></a><code><span><span class="keyword">val</span> iter_unifiable : <span><span>(<span><a href="#type-term">term</a> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span> unit)</span> <span class="arrow">&#45;&gt;</span></span> <span><span><span class="type-var">'a</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-term">term</a> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p><code>iter_unfiable f index query</code> applies <code>f</code> on all terms unifiable with <code>query</code>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-iter_specialize"><a href="#val-iter_specialize" class="anchor"></a><code><span><span class="keyword">val</span> iter_specialize : <span><span>(<span><a href="#type-term">term</a> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span> unit)</span> <span class="arrow">&#45;&gt;</span></span> <span><span><span class="type-var">'a</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-term">term</a> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p><code>iter_specialize f index query</code> applies <code>f</code> on all terms specializing <code>query</code>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-iter_generalize"><a href="#val-iter_generalize" class="anchor"></a><code><span><span class="keyword">val</span> iter_generalize : <span><span>(<span><a href="#type-term">term</a> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span> unit)</span> <span class="arrow">&#45;&gt;</span></span> <span><span><span class="type-var">'a</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-term">term</a> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p><code>iter_generalize f index query</code> applies <code>f</code> on all terms generalizing <code>query</code>.</p></div></div><p>The transient variants below are more efficient but must be used with care. The lifetime of the <code>internal_term</code>s ends when each call to the closure returns. Do not keep pointers to those <code>internal_term</code>s.</p><div class="odoc-spec"><div class="spec value anchored" id="val-iter_transient"><a href="#val-iter_transient" class="anchor"></a><code><span><span class="keyword">val</span> iter_transient : <span><span>(<span><a href="#type-internal_term">internal_term</a> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span> unit)</span> <span class="arrow">&#45;&gt;</span></span> <span><span><span class="type-var">'a</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p><code>iter_transient f index</code> iterates <code>f</code> on all bindings of <code>index</code>. Note that the lifetime of the <code>internal_term</code> passed to <code>f</code> ends when <code>f</code> returns.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-iter_unifiable_transient"><a href="#val-iter_unifiable_transient" class="anchor"></a><code><span><span class="keyword">val</span> iter_unifiable_transient : 
  <span><span>(<span><a href="#type-internal_term">internal_term</a> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span> unit)</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span class="type-var">'a</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="#type-term">term</a> <span class="arrow">&#45;&gt;</span></span>
  unit</span></code></div><div class="spec-doc"><p><code>iter_unfiable_transient f index query</code> applies <code>f</code> on all terms unifiable with <code>query</code>. Note that the lifetime of the <code>internal_term</code> passed to <code>f</code> ends when <code>f</code> returns.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-iter_specialize_transient"><a href="#val-iter_specialize_transient" class="anchor"></a><code><span><span class="keyword">val</span> iter_specialize_transient : 
  <span><span>(<span><a href="#type-internal_term">internal_term</a> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span> unit)</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span class="type-var">'a</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="#type-term">term</a> <span class="arrow">&#45;&gt;</span></span>
  unit</span></code></div><div class="spec-doc"><p><code>iter_specialize_transient f index query</code> applies <code>f</code> on all terms specializing <code>query</code>. Note that the lifetime of the <code>internal_term</code> passed to <code>f</code> ends when <code>f</code> returns.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-iter_generalize_transient"><a href="#val-iter_generalize_transient" class="anchor"></a><code><span><span class="keyword">val</span> iter_generalize_transient : 
  <span><span>(<span><a href="#type-internal_term">internal_term</a> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span> unit)</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span class="type-var">'a</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="#type-term">term</a> <span class="arrow">&#45;&gt;</span></span>
  unit</span></code></div><div class="spec-doc"><p><code>iter_generalize_transient f index query</code> applies <code>f</code> on all terms generalizing <code>query</code>. Note that the lifetime of the <code>internal_term</code> passed to <code>f</code> ends when <code>f</code> returns.</p></div></div></details></div><div class="odoc-spec"><div class="spec module anchored" id="module-Internal_for_tests"><a href="#module-Internal_for_tests" class="anchor"></a><code><span><span class="keyword">module</span> <a href="Internal_for_tests/index.html">Internal_for_tests</a></span><span> : <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div></div></div></body></html>
